/*! For license information please see bundle.search-providers.js.LICENSE.txt */
/* nemo v148.0.0 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("core-utils"),require("microkernel")):"function"==typeof define&&define.amd?define("search-providers",["core-utils","microkernel"],e):"object"==typeof exports?exports["search-providers"]=e(require("core-utils"),require("microkernel")):t["search-providers"]=e(t["core-utils"],t.microkernel)}(window,(function(t,e){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(i,a,function(e){return t[e]}.bind(null,a));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=79)}({1:function(e,r){e.exports=t},17:function(t){t.exports=JSON.parse('{"mediaService":{"api":"https://mediaservice.audi.com/renderapi/v1/urls","clientId":"4DWZjsGz","live":true}}')},31:function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var i=r(17);const a={exterior:{fullscreen:"aecwn8o1920x1152",flyout:"aecwn8o1920x600"},exterior_front:{fullscreen:"aecwn1o1920x1152",flyout:"aecwn1o1920x600"},exterior_back:{fullscreen:"aecwn6o1920x1152",flyout:"aecwn6o1920x600"},exterior_straight_front:{fullscreen:"aecwn3o1920x1152",flyout:"aecwn3o1920x600"},exterior_straight_back:{fullscreen:"aecwn5o1920x1152",flyout:"aecwn5o1920x600"},closeup_lights:{fullscreen:"aecwn2o1920x1152",flyout:"aecwn2o1920x600"},interior:{fullscreen:"aecwi1n1920x1152",flyout:"aecwi1n1920x600"},dashboard:{fullscreen:"aecwi2n1920x1152",flyout:"aecwi2n1920x600"}},n=Object.values(a).map(t=>[null==t?void 0:t.flyout,null==t?void 0:t.fullscreen]);function o(t,e){if(t&&t.length){const r=t.find(t=>t.config===e);return null==r?void 0:r.url}return null}const c=t=>null==t?void 0:t.startsWith("LC_PR"),s=async function(t){var e;const r=null==t?void 0:t.ave,s=t&&t["mbv-ids"];if(!r)return Promise.reject({});const d=r.split(","),u=d.slice(0,5),l=d.slice(5),h=d[3],f=d[4],g=d[2],m=d[1],p=null==t||null===(e=t.extColorCode)||void 0===e?void 0:e.selected,_=(null==s?void 0:s.exteriorColor)||h,v=(null==s?void 0:s.interiorColor)||f,S=(null==s?void 0:s.modelyear)||(null==t?void 0:t.modelyear)||g,y=m||(null==s?void 0:s.model)||(null==t?void 0:t.model),b={client:i.mediaService.clientId,brand:"ALL",configs:[].concat(...n),live:i.mediaService.live,modelRequests:[{modelCode:y,modelYear:S,exteriorColor:_,interiorColor:v,standardEquipments:l,mimeType:"image/png",...c(u[3])&&{aozEquipments:[p]}}]},w={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)};try{const t=await fetch(i.mediaService.api,w);if(t.ok)return t.json().then(t=>{var e;return(t=>t?Object.entries(a).reduce((e,r)=>{var i,a;return{...e,[r[0]]:{fullscreen:o(t,null===(i=r[1])||void 0===i?void 0:i.fullscreen),flyout:o(t,null===(a=r[1])||void 0===a?void 0:a.flyout)}}},{}):[])(null===(e=t.modelResults[0])||void 0===e?void 0:e.urlResult.filter(t=>null==t?void 0:t.url))});console.error("Response error from fetch images API: ",t)}catch(t){console.error("error occured when trying to fetch images from API:"+t)}}},4:function(t,r){t.exports=e},43:function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var i=r(4);class a{static get SEARCHPROVIDER_STORE_ID(){return"dbadSearchProviderStore"}static get SEARCHQUERY_STORE_ID(){return"dbadSearchQueryStore"}get searchResultStoreId(){return null}constructor(){i.stateRegistry.subscribeToStore(a.SEARCHQUERY_STORE_ID,t=>{this.performSearch(t.searchQuery)}),this.registerResultStore()}async registerResultStore(){this.searchResultStoreId&&(await this.waitForProviderStore(),i.stateRegistry.triggerAction(a.SEARCHPROVIDER_STORE_ID,"addSearchProvider",{searchProvider:this.searchResultStoreId}))}waitForProviderStore(){return new Promise(t=>{i.stateRegistry.subscribeToStore(a.SEARCHPROVIDER_STORE_ID,()=>{t()})})}performSearch(t){throw new Error("Implement performSearch in Subclass. (searchQuery: "+t+")")}publishResult(t,e){i.stateRegistry.triggerAction(this.searchResultStoreId,"update",{result:e,searchQuery:t})}setPreventSubmit(t=!1){i.stateRegistry.triggerAction(a.SEARCHPROVIDER_STORE_ID,"preventSubmit",{preventSubmit:t})}}},79:function(t,e,r){"use strict";r.r(e),r.d(e,"searchAudicode",(function(){return u}));var i=r(1),a=r(43),n=r(4);class o{constructor(){return o.instance||(this._initStore(),o.instance=this),o.instance}_initStore(){const t={update:this._update};n.stateRegistry.addStore("dbadAudicodeSearchStore",{result:null,searchQuery:null},t)}_update(t,e){return{...t,result:e.result,searchQuery:e.searchQuery}}}const c=new o;Object.freeze(c);var s=r(31);class d extends a.a{get searchResultStoreId(){return"dbadAudicodeSearchStore"}async performSearch(t){let e=null;if(this.isPossibleAudicode(t)){this.setPreventSubmit(!0);try{const r=await this.loadAudicode(t);if(r)if(this.isVTPAudicode(r.configuration)){const t={audicode:r.audicode,url:r.configuration.audicode["other-url"]};e=i.template.render('\n{{var target = SETUPS.get(\'scope.nemo.audicode.externallink\') ? \'target="blank"\' : \'\';}}\n<audi-configurator-search-vtp-audicode class="search-audicode" data-module="search-vtp-audicode">\n\t<div class="search-audicode__top">\n\t\t<div class="search-audicode__background-color-container"></div>\n\t\t<div class="search-audicode__text-container">\n\t\t\t<div class="search-audicode__audicode audi-copy-s">{{=window.i18n[\'search-layer.your-audicode\']}} {{=it.audicode}}</div>\n\t\t\t<h3 class="audi-headline-order-3 search-audicode__vtp-headline">{{=window.i18n[\'search-layer.available-cars\']}}</h3>\n\t\t\t<div class="audi-copy-m search-audicode__vtp-carinfo">{{=window.i18n[\'search-layer.available-cars-info\']}}</div>\n\t\t</div>\n\t</div>\n\t<div class="search-audicode__middle">\n\t\t<div class="search-audicode__background-color-container search-audicode__background-color-container--size60"></div>\n\t\t<div class="search-audicode__image-container search-audicode__image-container--vtp">\n\t\t\t<img class="search-audicode__image" src="{{=SETUPS.get(\'nemo.url.assets\')+"/img/fallback/fb-audicode-flyout.png"}}" alt="Fallback Image">\n\t\t</div>\n\t</div>\n\t<div class="search-audicode__text-container search-audicode__bottom">\n\t\t<a href="{{=it.url}}" {{=target}} class="audi-j-quick-search-result-tracking audi-link-m audi-link-m--arrow search-audicode__link">\n\t\t\t<span class="audi-link-m__text">{{=window.i18n[\'search-layer.your-car\']}}</span>\n\t\t\t<svg class="audi-link-m__icon">\n\t\t\t\t<use xlink:href={{=SETUPS.get(\'coreci.url.assets\')+"/icons/svg/forward-small.svg#audi-icon-forward-small"}}></use>\n\t\t\t</svg>\n\t\t</a>\n\t\t<p class="audi-copy-s search-audicode__reference">\n\t\t\t<span class="search-audicode__reference-label">{{=window.i18n[\'search-layer.label.disclaimer\']}}: </span>\n\t\t\t<span class="search-audicode__reference-text">{{=window.i18n[\'search-layer.vtp-warning\']}}</span>\n\t\t</p>\n\t</div>\n</audi-configurator-search-vtp-audicode>\n',t)}else{const t=await Object(s.a)(r.configuration.configuration),a={audicode:r.audicode,configuration:r.configuration.configuration,mediaservice:SETUPS.get("nemo.url.mediaservice"),images:t};e=i.template.render('\n{{?!!it.audicode}}\n\t{{?!!it.configuration}}\n\t\t{{? SETUPS.get(\'scope.nemo.audicode.externallink\')}}\n\t\t\t{{var target = "target=\'blank\'";}}\n\t\t{{??}}\n\t\t\t{{var target = "";}}\n\t\t{{?}}\n\t\t{{var link = \'/\' + it.audicode;}}\n\t\t{{?!!it.configuration.extColorCode && !!it.configuration.extColorCode.selected}}\n\t\t\t{{var selected = it.configuration.extColorCode.selected;}}\n\t\t\t{{var backgroundcolor = \'extcolor--\' + selected;}}\n\t\t\t{{var textcolor = \'extcolor-text--\' + selected;}}\n\t\t{{??}}\n\t\t\t{{var selected = "";}}\n\t\t\t{{var backgroundcolor = "";}}\n\t\t\t{{var textcolor = "";}}\n\t\t{{?}}\n\t\t<audi-configurator-search-audicode class="search-audicode" data-module="search-audicode">\n\t\t\t<div class="search-audicode__top">\n\t\t\t\t<div class="search-audicode__background-color-container {{=backgroundcolor}}"></div>\n\t\t\t\t<div class="search-audicode__text-container {{=textcolor}}">\n\t\t\t\t\t<div class="search-audicode__audicode audi-copy-s">{{=window.i18n[\'search-layer.your-audicode\']}} {{=it.audicode}}</div>\n\t\t\t\t\t{{?!!it.configuration}}\n\t\t\t\t\t\t{{?!!it.configuration.carlineName}}\n\t\t\t\t\t\t\t<h3 class="audi-headline-order-3 search-audicode__carline">{{=it.configuration.carlineName}}</h3>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t\t{{?!!it.configuration.description}}\n\t\t\t\t\t\t\t<div class="audi-copy-s search-audicode__engine">{{=it.configuration.description}}</div>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t\t{{?!!it.configuration.price}}\n\t\t\t\t\t\t\t<div class="audi-copy-m search-audicode__price">{{=it.configuration.price}}</div>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t{{?}}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="search-audicode__middle">\n\t\t\t\t<div class="search-audicode__background-color-container search-audicode__background-color-container--size60 {{=backgroundcolor}}"></div>\n\t\t\t\t<div class="search-audicode__image-container">\n\t\t\t\t\t{{?!!it.configuration && it.images && it.images[\'exterior\'] && it.images[\'exterior\'][\'flyout\']}}\n\t\t\t\t\t\t<picture>\n\t\t\t\t\t\t\t<source media="(max-width: 427px)" srcset="{{=it.mediaservice}}{{=it.images[\'exterior\'][\'flyout\']}}?imwidth=470">\n\t\t\t\t\t\t\t<img class="search-audicode__image" src="{{=it.mediaservice}}{{=it.images[\'exterior\'][\'flyout\']}}?imwidth=654">\n\t\t\t\t\t\t</picture>\n\t\t\t\t\t{{??}}\n\t\t\t\t\t\t<img class="search-audicode__image" src="{{=SETUPS.get(\'nemo.url.assets\')+"/img/fallback/fb-audicode-flyout.png"}}" alt="Fallback Image">\n\t\t\t\t\t{{?}}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="search-audicode__text-container search-audicode__bottom">\n\t\t\t\t<div>\n\t\t\t\t\t<a href="{{=link}}" {{=target}} class="audi-j-quick-search-result-tracking audi-link-m audi-link-m--arrow search-audicode__link">\n\t\t\t\t\t\t<span class="audi-link-m__text">{{=window.i18n[\'search-layer.load-configuration\']}}</span>\n\t\t\t\t\t\t<svg class="audi-link-m__icon">\n\t\t\t\t\t\t\t<use xlink:href={{=SETUPS.get(\'coreci.url.assets\')+"/icons/svg/forward-small.svg#audi-icon-forward-small"}}></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<p class="audi-copy-s search-audicode__reference">\n\t\t\t\t\t<span class="search-audicode__reference-label">{{=window.i18n[\'search-layer.label.disclaimer\']}}:</span>\n\t\t\t\t\t<span class="search-audicode__reference-text">{{=window.i18n[\'search-layer.configuration-overwrite-warning\']}}</span>\n\t\t\t\t</p>\n\t\t\t\t{{? !SETUPS.get(\'scope.nemo.hide.consumption-entries\')}}\n\t\t\t\t\t{{? it.configuration.techdata && (it.configuration.techdata[\'consumption-combined\'] || it.configuration.techdata[\'carbon-dioxide-emissions\'] || it.configuration.techdata[\'efficiency-class\'])}}\n\t\t\t\t\t\t{{? it.configuration.techdata[\'consumption-combined\']}}\n\t\t\t\t\t\t\t<dl class="audi-copy-s search-audicode__disclaimer">\n\t\t\t\t\t\t\t\t<dt class="search-audicode__disclaimer-label">{{=window.i18n[\'nemo.ui.consumption-combined\']}}*:</dt>\n\t\t\t\t\t\t\t\t<dd class="search-audicode__disclaimer-value">{{=it.configuration.techdata[\'consumption-combined\']}}</dd>\n\t\t\t\t\t\t\t</dl>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t\t{{? it.configuration.techdata[\'carbon-dioxide-emissions\']}}\n\t\t\t\t\t\t\t<dl class="audi-copy-s search-audicode__disclaimer">\n\t\t\t\t\t\t\t\t<dt class="search-audicode__disclaimer-label">{{=window.i18n[\'nemo.ui.emission-combined\']}}*:</dt>\n\t\t\t\t\t\t\t\t<dd class="search-audicode__disclaimer-value">{{=it.configuration.techdata[\'carbon-dioxide-emissions\']}}</dd>\n\t\t\t\t\t\t\t</dl>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t\t{{? !SETUPS.get(\'scope.nemo.hide.eec-entry\')}}\n\t\t\t\t\t\t\t{{? it.configuration.techdata[\'efficiency-class\']}}\n\t\t\t\t\t\t\t\t<dl class="audi-copy-s search-audicode__disclaimer">\n\t\t\t\t\t\t\t\t\t<dt class="search-audicode__disclaimer-label">{{=window.i18n[\'nemo.ui.efficiency-class\']}}:</dt>\n\t\t\t\t\t\t\t\t\t<dd class="search-audicode__disclaimer-value">{{=it.configuration.techdata[\'efficiency-class\']}}</dd>\n\t\t\t\t\t\t\t\t</dl>\n\t\t\t\t\t\t\t{{?}}\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t{{?}}\n\t\t\t\t{{?}}\n\t\t\t</div>\n\t\t</audi-configurator-search-audicode>\n\t{{?}}\n{{?}}',a)}}catch(r){const a={errorMessage:this.getErrorMessage(r),pdfLink:this.getPdfLink(t,r)};e=i.template.render('\n<audi-configurator-search-audicode-error class="search-audicode" data-module="search-audicode">\n\t<div class="search-audicode__text-container search-audicode__top search-audicode__bottom">\n\t\t<p class="audi-copy-s search-audicode__error">{{=it.errorMessage}}</p>\n\t\t{{?it.pdfLink}}\n\t\t\t<div class="search-audicode__error-pdflink">\n\t\t\t\t<a class="audi-link-s audi-link-s--arrow-front" href="{{=it.pdfLink.url}}" target="_blank">\n\t\t\t\t\t<span class="audi-link-s__text">{{=it.pdfLink.label}}</span>\n\t\t\t\t\t<svg class="audi-link-s__icon">\n\t\t\t\t\t\t<use xlink:href="{{=SETUPS.get(\'coreci.url.assets\')+"/icons/svg/print-small.svg#nm-icon-print-small"}}"></use>\n\t\t\t\t\t</svg>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t{{?}}\n\t</div>\n</audi-configurator-search-audicode-error>',a)}}this.publishResult(t,e)}getPdfLink(t,e){if("AUDICODE_CONF_NOT_VALID"===e.id&&SETUPS.get("scope.nemo.audicode.not_valid_pdflink")){const e="search-layer.audicode-pdf";return{label:window.i18n&&window.i18n[e]?window.i18n[e]:"PDF anzeigen",url:SETUPS.get("nemo.pdf.url")+"/audicode/"+t}}return null}isPossibleAudicode(t){return!!t&&!this.isStopword(t)&&this.matchesAudicodePattern(t)}isVTPAudicode(t){return t.audicode&&t.audicode.application&&"VTP"===t.audicode.application}isStopword(t){const e=SETUPS.get("nemo.search.audicodestopwords");return!!e&&e.split(",").includes(t)}matchesAudicodePattern(t){return!!t.match(/^[Aa]{1}[a-zA-Z0-9]{7}$/)}async loadAudicode(t){const e=await this.loadConfigurationByAudiCode(t);return e?{audicode:t.toUpperCase(),configuration:e}:null}async loadConfigurationByAudiCode(t){const e=SETUPS.get("nemo.url.dpu")+"audicode?"+new URLSearchParams({audicode:t.toUpperCase(),context:SETUPS.get("nemo.default.header").context}).toString();return fetch(e,{credentials:"include"}).then(t=>{if(t.ok)return t.json();this.setupAndThrowError({statuscode:t.status})}).then(this.checkDPUresponseStatus.bind(this))}setupAndThrowError(t){const e=new Error;throw e.status=t.statuscode,t.audicode&&t.audicode.message&&(e.name="custom-dpu-error"),t.header&&t.header.error&&(e.id=t.header.error.id,e.message=t.header.error.message?t.header.error.message:t.header.statusmessage),e}checkDPUresponseStatus(t){if(t.header&&t.header.statuscode){const e=Math.floor(t.header.statuscode/100);3!==e&&5!==e||this.setupAndThrowError(t)}return t}getErrorMessage(t){const e=this.getErrorMessageFromI18N(t),r=e||t.message;return r||this.getErrorMessageFromI18N("DEFAULT")}getErrorMessageFromI18N(t){const e="string"==typeof t?t:t.id;return window.i18n["error.message."+e]}}const u=new d;class l{constructor(){return l.instance||(this._initStore(),l.instance=this),l.instance}_initStore(){const t={addSearchProvider:this._addSearchProvider,preventSubmit:this._preventSubmit};n.stateRegistry.addStore("dbadSearchProviderStore",{searchProviderList:[],preventSubmit:!1},t)}_addSearchProvider(t,e){return t.searchProviderList.push(e.searchProvider),t}_preventSubmit(t,e){return{...t,preventSubmit:e.preventSubmit}}}const h=new l;Object.freeze(h);class f{constructor(){return f.instance||(this._initStore(),f.instance=this),f.instance}_initStore(){const t={clear:this._clear,update:this._update};n.stateRegistry.addStore("dbadSearchQueryStore",{searchQuery:null},t)}_clear(t){return{...t,searchQuery:null}}_update(t,e){return{...t,searchQuery:e.searchQuery}}}const g=new f;Object.freeze(g)}})}));
//# sourceMappingURL=bundle.search-providers.js.map